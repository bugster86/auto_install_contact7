- name: rimuovo file di cron che non devono essere sulla cti
  file: 
    dest: "{{ item }}"
    state: absent
  with_items:
  - /etc/cron.d/backup_gateway.cron
  - /etc/cron.d/canc_cache_vxml.cron
  - /etc/cron.d/extract_audio.cron
  - /etc/cron.d/msachk.crontab
  - /etc/cron.d/msa.crontab
  - /etc/cron.d/msa_remove_cache_file.cron
  - /etc/cron.d/rasd_reload.cron
  - /etc/cron.d/tomcat.cron
  - /etc/cron.d/stat_log_importer.cron
  - /etc/cron.d/check_x2l.cron
  - /etc/cron.d/monitor_scalar.cron
  - /etc/cron.d/stat_log_importer.cron
  
- name: Elimino il file /etc/cron.d/opensips_checker.cron se non sono sulla cti1
  file: dest=/etc/cron.d/opensips_checker.cron state=absent
  when: inventory_hostname.find('cti1') == -1
  
- shell: rm -fr /var/www/html/*
  changed_when: false
  

- block:
  - name: rimuovo opensips sui server dove non deve essere presente  
    shell: rpm -e $(rpm -qa | grep ^opensips-) ; rm -fr /etc/opensips
    failed_when: false  
  when: 'cti1' not in inventory_hostname
  
- block:
  - name: attivo il servizio redis
    service: name=redis state=started enabled=true 
    
  - name: valorizzo il template del file di configurazione di OPENSIPS
    template:
        src: ..templates/opensips.cfg.j2
        dest: /etc/opensips/opensips.cfg
        mode: 0645
        owner: opensips
        group: opensips
  - name: Avvio il servizio OPENSIPS
    service: name=opensips state=started enabled=true 
  when:  'cti1' in inventory_hostname

- include_tasks: crea_ldap.yml
